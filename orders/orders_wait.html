<!DOCTYPE html>
<html class="um landscape min-width-240px min-width-320px min-width-480px min-width-768px min-width-1024px">

	<head>
		<title></title>
		<meta charset="utf-8">
		<meta name="viewport" content="target-densitydpi=device-dpi, width=device-width, initial-scale=1, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<link rel="stylesheet" href="../css/fonts/font-awesome.min.css">
		<link rel="stylesheet" href="../css/ui-box.css">
		<link rel="stylesheet" href="../css/ui-base.css">
		<link rel="stylesheet" href="../css/ui-color.css">
		<link rel="stylesheet" href="../css/appcan.icon.css">
		<link rel="stylesheet" href="../css/appcan.control.css">
		<link rel="stylesheet" href="orders_content/css/main.css" />
	</head>

	<body class="um-vp bc-bg obody" ontouchstart>
		<!--
        	作者：offline
        	时间：2016-09-20
        	描述：账单模板
        -->
		<div class="temp" style="display: none;">
			<div class="itemsorder">
				<div class="all_order" id="allOrderid">
					<div class="order_item">
						<div class="ub order_num order_check" onclick="signlebtnclick(this)">
							<div class="ub  ub-ac ub-pc umar-r checkImg check_box">
								<img id="allchoose" href="" price="" class="allitem uhide check_ok ub-img" src="../css/images/checkbtn.png" />
							</div>
							<div class="ub ub-ac ub-f1">
								订单号：<span class="ForderNum"></span>
							</div>
							<div class="ub ub-ac order_state FpayState">

							</div>
						</div>
						<div class="ub order_content">
							<div class="ub ub-f1 ordder_main">
								<div class="ub ub-ver order_detial ub-f1">
									<div class="ub umar-b order_dtitle">
										<div class="ub-img dimg umar-r dimg">
											<img src="../css/images/order3.png" />
										</div>
										<div class="ub ub-ac ForderName">

										</div>
									</div>
									<div class="ub umar-b ">
										商品总重量：<span class="Ftotalweight"></span> kg
									</div>
									<div class="ub ">
										下单时间：<span class="FdownTime"></span>
									</div>
								</div>
							</div>
							<div class="ub ub-ver ub-pc uhide">
								<div class="ub umar-b bcolor">
									x<span>5</span>
								</div>
								<div class="ub dcolor">
									￥<span class=""></span>
								</div>
							</div>
						</div>
						<!-- 查看更多-->
						<div class="ub ub-ver order_more">
							<div class="ub ub-ac  order_count">
								<div class="ub ub-f1">
									共<span class="Fcounts"></span>件商品 合计：¥ <span class="FlastPrice"></span>
								</div>
								<div class="ub ub-ac ub-pc ksxd Fstate uhide">
									等待发货
								</div>
							</div>
							<div class="ub ub-ac ub-pc more_top">
								<div class="ub">查看更多</div>
								<img src="../css/images/more.png" />
							</div>
						</div>
						<div class="ub ub-ver more_count uhide morechild">

						</div>
						<div class="ub ub-ver  order_up uhide">
							<div class="ub ub-ac  order_count">
								<div class="ub ub-f1">
									共<span class="Fcounts"></span>件商品 合计：¥ <span class="FlastPrice"></span>
								</div>
								<div class="ub ub-ac ub-pc ksxd Fstate">
									等待发货
								</div>
							</div>
							<div class="ub ub-ac ub-pc more_top">
								<div class="ub">收起</div>
								<img src="../css/images/more_up.png" />
							</div>
						</div>
					</div>
				</div>

			</div>
		</div>
		<!-- 全部账单列表-->
		<div id="orderlist" class="orderlist">

		</div>
		<!--
        	作者：offline
        	时间：2016-09-20
        	描述：详情模板
        -->
		<div id="orderchildtemp" class="uhide">
			<div class="ub ub-ac ub-f1 more_item childitem">
				<div class="ub ub-f1 ub-fh Fgoodsname">
				</div>
				<div class="ub ub-ac ub-fh ub-f1">
					x<span class="FtotalCount"></span>
				</div>
				<div class="ub ub-f1 ub-fh dcolor">
					￥<span class="FlastPrice"></span>
				</div>
				<div class="ub ub-ac ub-f1 ub-fh">
					<span>￥</span>
					<span class="Ftotalmoney"></span>
				</div>
			</div>
		</div>
		<div id="footer" class="ub bc-text-head  footer2 " style=" z-index: 9999999;position: fixed; left: 0; bottom: 0; width: 100%;">
			<div class="ub ub-f1" style=" height: 3em;width: 100%;">
				<div class="ub ub-ac ub-f2 " style="background: #313131">
					<div class="ub-f1 ub" style=" height: 3em">
						<div class="ub ub-pc ub-ac ub-f2" style="background: #313131">
							<div class="ub ub-ac ub-pc check_all" onclick="allbtnclick(this)">
								<div class="ub  ub-ac ub-pc umar-r checkImg ">
									<img id="allchoose" class="allitem uhide all_sure ub-img" src="../css/images/checkbtn.png" />
								</div>
								<div class="ub">
									<span>合计：</span>
									<span class="umar-l">￥</span>
									<span class="totalchoose" id="totalmoney">0.00</span>
								</div>
							</div>
						</div>
						<div class="ub ub-ac ub-pc ub-f1" style="background: #f2af27">
							<div class="ub ub-ac ub-pc" onclick="gotopays()">
								<div class="ub ub-pc ub-ac open-submit">去付款</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</body>
	<script src="../js/appcan.js"></script>
	<script src="../js/appcan.control.js"></script>
	<script type="text/javascript" src="../js/yfkj.js"></script>
	</body>
	<script>
		var Fstart = 0;
		var pageSize = 10;
		var FdetailbillId = "";
		var values = 0;
		appcan.ready(function() {
			appcan.window.subscribe('quicksess', function(msg) {
				$('.orderlist').empty();
				Fstart = 0;
				getorderwait();
				$(".totalchoose").text("0.00");
			});
			getorderwait();
			appcan.frame.setBounce([0, 1], function(type) {
				$("#pullstatus" + type).html(!type ? "开始下拉" : "开始上拖");
			}, function(type) {
				$("#pullstatus" + type).html(!type ? "下拉超过临界点,产生事件了！" : "超过临界点,产生事件了！");
			}, function(type) {
				if(type == 0) {
					$('.orderlist').empty();
					Fstart = 0;
					getorderwait();
					$(".totalchoose").text("0.00");
				} else if(type == 1) {
					$(".totalchoose").text("0.00");
					getorderwait();
				}
				setTimeout(function() {
					appcan.frame.resetBounce(type);
				}, 1000);
			})
		});

		$(".order_more").click(function() {
			$(this).addClass("uhide");
			$(this).siblings(".more_count").removeClass("uhide");
			$(this).siblings(".order_up").removeClass("uhide");
		});

		$(".order_up").click(function() {
			$(this).addClass("uhide");
			$(this).siblings(".more_count").addClass("uhide");
			$(this).siblings(".order_more").removeClass("uhide");
		});

		function getorderwait() {
			var parm = {
				Fuserid: Fsuper.getuserid(),
				pageSize: pageSize,
				Fstart: Fstart,
				FwhereState: 3
			}
			Fsuper.getrows('/App/getorderwait', parm, addorder);
		}

		function addorder(row, end) {
			var list = $(".orderlist");
			var item = $(".temp").clone();
			var domitem = item.find(".itemsorder");
			domitem.attr("id", row.Fgoodsid);
			domitem.addClass("waitlist" + row.Forderid);
			domitem.find(".Ftotalweight").text(row.Ftotalweight);
			domitem.find(".ForderName").text(row.ForderName);
			domitem.find(".ForderNum").text(row.ForderNum);
			domitem.find(".check_ok").attr("href", row.Forderid);
			domitem.find(".check_ok").attr("price", row.FlastPrice.toFixed(2));
			domitem.find(".FdownTime").text(row.FdownTime);
			domitem.find(".FlastPrice").text(row.FlastPrice.toFixed(2));
			domitem.find(".order_more").attr('onclick', "order_more(this)");
			domitem.find(".order_up").attr('onclick', "order_up(this)");
			domitem.find(".Fstate").attr('onclick', "quickpay('" + row.Forderid + "')");
			if(row.Fstate == 4) {
				domitem.find(".FpayState").text("待付款");
				domitem.find(".Fstate").text("立即支付");
			}
			getGoodsByCatid(list, domitem, row.Forderid);
			list.append(domitem);
			Fstart = end;
		}

		function order_more(dom) {
			$(dom).addClass("uhide");
			$(dom).siblings(".more_count").removeClass("uhide");
			$(dom).siblings(".order_up").removeClass("uhide");
		}

		function order_up(dom) {
			$(dom).addClass("uhide");
			$(dom).siblings(".more_count").addClass("uhide");
			$(dom).siblings(".order_more").removeClass("uhide");
		}
		//订单详情
		function getGoodsByCatid(list, domitem, id) {
			var furl = "/app/getorderwaitmx";
			appcan.ajax({
				url: Serverurl + furl,
				type: "POST",
				dataType: "json",
				data: {
					Forderid: id
				},
				success: function(result) {
					var rows = result.data.rows;
					var code = result.code;
					var msg = result.msg;
					var debug = result.debug;
					var length = rows.length;
					if(code < 10000) {
						if(code == 0) { //返回成功
							$(rows).each(function(i, row) {
								additems(list, domitem, row, length, id);
							});
						}
					} else {
						if(Fsuperdbg) {
							alert(result.code);
							alert(result.msg);
							alert(result.debug);
						}
					}
				}
			});

		}

		function additems(list, domitem, row, length, id) {
			domitem.find(".Fcounts").text(length);
			var goodslist = $(".waitlist" + id).find(".morechild");
			//var goodslist = domitem.find(".morechild");
			var clonedom = $("#orderchildtemp").clone();
			var goodsdom = clonedom.find(".childitem");
			goodsdom.find(".Fgoodsname").text(row.Fgoodsname);
			goodsdom.find(".FtotalCount").text(row.FtotalCount);
			goodsdom.find(".FlastPrice").text(row.FlastPrice.toFixed(2));
			goodsdom.find(".Ftotalmoney").text(row.Ftotalmoney.toFixed(2));
			goodslist.append(goodsdom);
			//list.append(domitem);
		}
		//立即支付
		function quickpay(id) {
			event.stopPropagation();
			appcan.locStorage.setVal("Forderid", id);
			appcan.window.open("quickPay", "../quickPay/quickPay.html");
		}
		//		//单选
		//		$(".order_check").click(function() {
		//			var curr = $(this).find(".check_ok");
		//			if($(curr).hasClass("uhide")) {
		//				$(curr).removeClass("uhide");
		//			} else {
		//				$(curr).addClass("uhide");
		//				$(".all_sure").addClass("uhide");
		//			}
		//		});
		//		//全选
		//		$(".check_all").click(function(){
		//			var curr_all = $(this).find(".all_sure");
		//			if($(curr_all).hasClass("uhide"))
		//			{
		//				$(curr_all).removeClass("uhide");
		//				$(".check_ok").removeClass("uhide");
		//			} else {
		//				$(curr_all).addClass("uhide");
		//				$(".check_ok").addClass("uhide");
		//			}
		//		});
		//单选按钮
		function signlebtnclick(dom) {
			var curr = $(dom).find(".check_ok");
			if($(curr).hasClass("uhide")) {
				$(curr).removeClass("uhide");
				$(curr).addClass("activesel");
			} else {
				$(curr).addClass("uhide");
				$(".all_sure").addClass("uhide");
				$(curr).removeClass("activesel");
			}
			getValue();
		}
		//全选按钮
		function allbtnclick(dom) {
			var curr_all = $(dom).find(".all_sure");
			if($(curr_all).hasClass("uhide")) {
				$(curr_all).removeClass("uhide");
				$(".check_ok").removeClass("uhide");
				$(".check_ok").addClass("activesel");
			} else {
				$(curr_all).addClass("uhide");
				$(".check_ok").addClass("uhide");
				$(".check_ok").removeClass("activesel");
			}
			getValue();
		}

		//取值
		function getValue() {
			var lists = $(".activesel");
			var values = 0;
			nFdetailbillId = "";
			FdetailbillId = "";
			lists.each(function(i, item) {
				var id = $(item).attr("href");
				if(id != "") {
					var value = $(item).attr("price");
					nFdetailbillId = nFdetailbillId + id + ",";
					values = values + parseFloat(value);
				}
			});
			$(".totalchoose").text(values.toFixed(2));
			FdetailbillId = nFdetailbillId.substring(0, nFdetailbillId.length - 1);
		}
		//去付款
		function gotopays() {
			var Fvaues = $(".totalchoose").text();
			appcan.locStorage.setVal("values", Fvaues);
			appcan.locStorage.setVal("payForderids", FdetailbillId);
			//appcan.window.publish('values', Fvaues);
			//appcan.window.publish('payForderids', FdetailbillId);
			appcan.window.open("quickPay", "../quickPay/quickPay.html");
		}
	</script>

</html>