<!DOCTYPE html>
<html class="um landscape min-width-240px min-width-320px min-width-480px min-width-768px min-width-1024px">

	<head>
		<title></title>
		<meta charset="utf-8">
		<meta name="viewport" content="target-densitydpi=device-dpi, width=device-width, initial-scale=1, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<link rel="stylesheet" href="../css/fonts/font-awesome.min.css">
		<link rel="stylesheet" href="../css/ui-box.css">
		<link rel="stylesheet" href="../css/ui-base.css">
		<link rel="stylesheet" href="../css/ui-color.css">
		<link rel="stylesheet" href="../css/appcan.icon.css">
		<link rel="stylesheet" href="../css/appcan.control.css">
		<link rel="stylesheet" href="orders_content/css/main.css" />
	</head>

	<body class="um-vp bc-bg obody" ontouchstart>
		<!--
        	作者：offline
        	时间：2016-09-20
        	描述：账单模板
        -->
		<div class="temp" style="display: none;">
			<div class="itemsorder">
				<div class="all_order" id="allOrderid">
					<div class="order_item">
						<div class="ub order_num">
							<div class="ub ub-ac ub-f1">
								订单号：<span class="ForderNum"></span>
							</div>
							<div class="ub ub-ac order_state FpayState">

							</div>
						</div>
						<div class="ub order_content">
							<div class="ub ub-f1 ordder_main">
								<div class="ub ub-ver order_detial ub-f1">
									<div class="ub umar-b order_dtitle">
										<div class="ub-img dimg umar-r dimg">
											<img src="../css/images/order3.png" />
										</div>
										<div class="ub ub-ac ForderName">

										</div>
									</div>
									<div class="ub umar-b ">
										商品总重量：<span class="Ftotalweight"></span> kg
									</div>
									<div class="ub ">
										下单时间：<span class="FdownTime"></span>
									</div>
								</div>
							</div>
							<div class="ub ub-ver ub-pc uhide">
								<div class="ub umar-b bcolor">
									x<span>5</span>
								</div>
								<div class="ub dcolor">
									￥<span class=""></span>
								</div>
							</div>
						</div>
						<!-- 查看更多-->
						<div class="ub ub-ver order_more">
							<div class="ub ub-ac  order_count">
								<div class="ub ub-f1">
									共<span class="Fcounts"></span>件商品 合计：¥ <span class="FlastPrice"></span>
								</div>
							</div>
							<div class="ub shbtns ub-pe ">
								<div class="ub ub-ac ub-pc ksxd quickOrder">
									快速下单
								</div>
							</div>
							<div class="ub ub-ac ub-pc more_top">
								<div class="ub">查看更多</div>
								<img src="../css/images/more.png" />
							</div>
						</div>
						<div class="ub ub-ver more_count uhide morechild">

						</div>
						<div class="ub ub-ver  order_up uhide">
							<div class="ub ub-ac  order_count">
								<div class="ub ub-f1">
									共<span class="Fcounts"></span>件商品 合计：¥ <span class="FlastPrice"></span>
								</div>
							</div>
							<div class="ub shbtns ub-pe ">
								<div class="ub ub-ac ub-pc ksxd quickOrder">
									快速下单
								</div>
							</div>
							<div class="ub ub-ac ub-pc more_top">
								<div class="ub">收起</div>
								<img src="../css/images/more_up.png" />
							</div>
						</div>
					</div>
				</div>

			</div>
		</div>
		<!-- 全部账单列表-->
		<div id="orderlist" class="orderlist">

		</div>
		<!--
        	作者：offline
        	时间：2016-09-20
        	描述：详情模板
        -->
		<div id="orderchildtemp" class="uhide">
			<div class="ub ub-ac ub-f1 more_item childitem">
				<div class="ub item_left">
					<div class="ub ub-ac item_name Fgoodsname">
					</div>
					<div class="ub ub-ac item_num">
						x<span class="FtotalCount"></span>
					</div>
					<div class="ub ub-ac item_price dcolor">
						￥<span class="FlastPrice"></span>
					</div>
				</div>
				<div class="ub ub-ac ub-f1">
					<div class="ub ub-f1  ub-ac  item_count">
						<span>￥</span>
						<span class="Ftotalmoney"></span>
					</div>
					<div class="ub ub-ac">
						<div class="ub ub-ac ub-pc item_apply appTusu">
							申诉
						</div>
					</div>
				</div>
			</div>
		</div>
	</body>
	<script src="../js/appcan.js"></script>
	<script src="../js/appcan.control.js"></script>
	<script type="text/javascript" src="../js/yfkj.js"></script>
	</body>
	<script>
		var Fstart = 0;
		var pageSize = 10;
		var userinfo = Fsuper.getuserinfo();
		appcan.ready(function() {
			appcan.window.subscribe('movetosuccess', function(msg) {
				$('.orderlist').empty();
				Fstart = 0;
				getorderwait();
			});
			getorderwait();
			appcan.frame.setBounce([0, 1], function(type) {
				$("#pullstatus" + type).html(!type ? "开始下拉" : "开始上拖");
			}, function(type) {
				$("#pullstatus" + type).html(!type ? "下拉超过临界点,产生事件了！" : "超过临界点,产生事件了！");
			}, function(type) {
				if(type == 0) {
					$('.orderlist').empty();
					Fstart = 0;
					getorderwait();
				} else if(type == 1) {
					getorderwait();
				}
				setTimeout(function() {
					appcan.frame.resetBounce(type);
				}, 1000);
			})
		});

		$(".order_more").click(function() {
			$(this).addClass("uhide");
			$(this).siblings(".more_count").removeClass("uhide");
			$(this).siblings(".order_up").removeClass("uhide");
		});

		$(".order_up").click(function() {
			$(this).addClass("uhide");
			$(this).siblings(".more_count").addClass("uhide");
			$(this).siblings(".order_more").removeClass("uhide");
		});

		function getorderwait() {
			var parm = {
				Fuserid: Fsuper.getuserid(),
				pageSize: pageSize,
				Fstart: Fstart,
				FwhereState: 0
			}
			Fsuper.getrows('/App/getorderwait', parm, addorder);
		}

		function addorder(row, end) {
			var list = $(".orderlist");
			var item = $(".temp").clone();
			var domitem = item.find(".itemsorder");
			domitem.attr("id", row.Fgoodsid);
			domitem.addClass("list"+row.Forderid);
			domitem.find(".Ftotalweight").text(row.Ftotalweight);
			domitem.find(".ForderName").text(row.ForderName);
			domitem.find(".ForderNum").text(row.ForderNum);
			domitem.find(".FdownTime").text(row.FdownTime);
			domitem.find(".FlastPrice").text(row.FlastPrice.toFixed(2));
			domitem.find(".order_more").attr('onclick', "order_more(this)");
			domitem.find(".order_up").attr('onclick', "order_up(this)");
			domitem.find(".quickOrder").attr('onclick', "quickOrder(" + row.Forderid + ")");
			domitem.find(".FpayState").text("交易成功");
			getGoodsByCatid(list, domitem, row.Forderid);
			list.append(domitem);
			Fstart = end;
		}

		function order_more(dom) {
			$(dom).addClass("uhide");
			$(dom).siblings(".more_count").removeClass("uhide");
			$(dom).siblings(".order_up").removeClass("uhide");
		}

		function order_up(dom) {
			$(dom).addClass("uhide");
			$(dom).siblings(".more_count").addClass("uhide");
			$(dom).siblings(".order_more").removeClass("uhide");
		}
		//订单详情
		function getGoodsByCatid(list, domitem, id) {
			var furl = "/app/getorderwaitmx";
			appcan.ajax({
				url: Serverurl + furl,
				type: "POST",
				dataType: "json",
				data: {
					Forderid: id
				},
				success: function(result) {
					var rows = result.data.rows;
					var code = result.code;
					var msg = result.msg;
					var debug = result.debug;
					var length = rows.length;
					if(code < 10000) {
						if(code == 0) { //返回成功
							$(rows).each(function(i, row) {
								additems(list, domitem, row, length, id);
							});
						}
					} else {
						if(Fsuperdbg) {
							alert(result.code);
							alert(result.msg);
							alert(result.debug);
						}
					}
				}
			});

		}

		function additems(list, domitem, row, length, id) {
			domitem.find(".Fcounts").text(length);
			//var goodslist = domitem.find(".morechild");
	        var goodslist=$(".list"+id).find(".morechild");
			var clonedom = $("#orderchildtemp").clone();
			var goodsdom = clonedom.find(".childitem");
			goodsdom.find(".Fgoodsname").text(row.Fgoodsname);
			goodsdom.find(".FtotalCount").text(row.FtotalCount);
			goodsdom.find(".FlastPrice").text(row.FlastPrice);
			goodsdom.find(".Ftotalmoney").text(row.Ftotalmoney.toFixed(2));
			goodsdom.find(".appTusu").attr("onclick", "appTusu(" + row.Fgoodsid + "," + id + ",this)");
			if(row.Fdetailtusu == "1") {
				goodsdom.find(".appTusu").text("已申诉");
				goodsdom.find(".appTusu").addClass("hastusu");
				goodsdom.find(".appTusu").removeAttr("onclick");
			}
			goodslist.append(goodsdom);
			//list.append(domitem);
		}
		//快速下单
		function quickOrder(id) {
			event.stopPropagation();
			var furl = '/app/quickOrder';
			var parm = {
				Forderid: id,
				Fuserid: Fsuper.getuserid(),
				Fbmid: userinfo.FBmid
			};
			Fsuper.getresult(furl, parm, getrest);
		}

		function getrest(row, code) {
			if(code == 0) {
				appcan.window.publish('successorder', '');
				appcan.window.open("shopCar", "../shopCar/shopCar.html");
			}
		}
		//投诉
		function appTusu(Fid, Fgoodsid, dom) {
			appcan.window.alert({
				title: "提示",
				content: "您确定投诉吗？",
				buttons: ['取消', '确定'],
				callback: function(err, data, dataType, optId) {
					if(data == 1) {
						appTusufunction(Fid, Fgoodsid, dom);
					}
				}
			});
			
		}

		function appTusufunction(Fid, Fgoodsid, dom) {
			var furl = '/app/appTusu';
			var parm = {
				Fid: Fgoodsid,
				Fgoodsid: Fid
			}
			appcan.ajax({
				url: Serverurl + furl,
				type: "POST",
				dataType: "json",
				data: parm,
				success: function(result) {
					var rows = result.data;
					var code = result.code;
					var msg = result.msg;
					var debug = result.debug;
					if(code < 10000) {
						if(code == 0) {
							$(dom).text("已申诉");
							$(dom).addClass("hastusu");
							$(dom).removeAttr("onclick");
						}
					} else {
						if(Fsuperdbg) {
							alert(result.code);
							alert(result.msg);
							alert(result.debug);
						}
					}
				}
			});
		}
	</script>

</html>